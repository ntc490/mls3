{% extends "base.html" %}

{% block title %}SMS Composer - {{ member.full_name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="composer-header">
        <h1>SMS Composer</h1>
        <p class="member-name">To: {{ member.full_name }}</p>
        {% if member.is_minor %}
        <p class="info-message">üì± Message will be sent to parent(s)</p>
        {% elif not member.phone %}
        <p class="error-message">‚ö†Ô∏è This member has no phone number on file</p>
        {% endif %}
    </div>

    <div class="composer-form">
        <!-- Template Selector -->
        <div class="form-group">
            <label for="templateSelect">Message Template</label>
            <select id="templateSelect" class="form-select">
                <option value="">-- Select Template --</option>
                {% for template_name in adhoc_templates.keys() %}
                <option value="{{ template_name }}">
                    {{ template_name|replace('_', ' ')|title }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Custom Variables Section (shown dynamically) -->
        <div id="customVarsSection" class="custom-vars-section" style="display: none;">
            <h3>Custom Variables</h3>
            <div id="customVarInputs"></div>
        </div>

        <!-- Message Text Area -->
        <div class="form-group">
            <label for="messageText">Message</label>
            <textarea id="messageText"
                      class="form-textarea"
                      rows="8"
                      placeholder="Select a template or type your message..."></textarea>
            <div class="message-info">
                <span id="charCount">0 characters</span>
                <span class="text-muted">SMS messages are typically limited to 160 characters per segment</span>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="composer-actions">
            <button id="expandBtn" class="btn btn-secondary">
                Expand
            </button>
            <button id="sendBtn" class="btn btn-primary">
                Send
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Pass data to JavaScript
    const memberId = {{ member.member_id }};
    const memberPhone = "{{ member.phone }}";
    const templates = {{ adhoc_templates|tojson }};
</script>
<script src="{{ url_for('static', filename='js/sms_composer.js') }}"></script>
{% endblock %}
